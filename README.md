# HRV Readiness Analysis

This project processes RR interval data (the difference between each R peak on an ECG given in ms) from various HRV monitoring apps to calculate heart rate variability (HRV) metrics and give you a more in-depth perspective of your training readiness. It's like having Kubios Premium, but without the premium price tag! ðŸ˜‰ The lite version doesn't allow you to batch process multiple files concurrently.

## Supported File Formats

### Plain Text Files (.txt)
- Each line or comma-separated value represents an RR interval in milliseconds
- Supported by EliteHRV and other apps that export raw RR data

### CSV Files (.csv)
- Must contain a column named 'RR' (case-insensitive) with RR intervals in milliseconds
- Supported by ECGApp and other HRV monitoring tools
- Only rows with valid RR values are processed

## Features

### Time Domain Metrics

- SDNN: Standard deviation of NN intervals (overall HRV)
- RMSSD: Root mean square of successive differences (parasympathetic activity). This is the one given by most apps
- pNN50: Percentage of NN intervals differing by >50ms
- Mean HR: Average heart rate in BPM that was captured during the recording

### Frequency Domain Metrics

- LF Power: Low frequency power (0.04-0.15 Hz standard band)
- HF Power: High frequency power (0.15-0.40 Hz standard band)
- LF/HF Ratio: Sympathovagal balance
- Total Power: Overall HRV power

### Non-linear Metrics

- Sample Entropy: Complexity of HRV
- DFA Î±1: Detrended Fluctuation Analysis (fractal scaling)
  > **Note:** For accurate DFA Î±1 calculations, recordings should be at least 5 minutes long. Shorter recordings may yield unreliable results.

### Readiness Indicators

The script calculates z-scores for key metrics to assess readiness:

#### RMSSD Z-scores

- Warning: Below -1.5 SD (potential stress/overreaching)
- Alert: Below -2.0 SD (high stress/overtraining risk)

#### Mean HR Z-scores

- Warning: Above +1.0 SD (elevated resting HR)
- Alert: Above +1.5 SD (significantly elevated resting HR)

#### DFA Î±1

- Warning threshold: Below 0.75 (reduced complexity)

## Setup

1. **Create a virtual environment:**

   ```sh
   python -m venv venv
   ```

2. **Activate the virtual environment:**
   - On Windows:

     ```sh
     venv\Scripts\activate
     ```

   - On macOS/Linux:

     ```sh
     source venv/bin/activate
     ```

3. **Install dependencies:**

   ```sh
   pip install -r requirements.txt
   ```

## Usage

```bash
./batch_rr.py /path/to/rr_exports [--excel] [--window WINDOW_SIZE]
```

> **Note:** The folder can contain both .txt and .csv files. For .txt files, each should be named in the format "YYYY-MM-DD HH-MM-SS.txt" (e.g., "2024-03-20 07-30-00.txt"). For .csv files, they must contain an 'RR' column with the interval data. If a file name lacks a date (e.g. some ECGApp exports), the script falls back to the file's modification timestamp.

Options:

- `--excel`: Flag to generate Excel report with visualizations for the z-scores, annotated with warning thresholds.
- `--window`: Rolling window size in days (default: 14). Ideally the window should be as large as possible to even out false flags.

## Output

1. CSV file with all metrics
2. Excel report (optional) with:
   - Raw metrics
   - Rolling statistics and z-scores
   - Trend visualization

### Example Output

Below is an example of the trend visualization generated by the script:

![Example HRV trend graph](example_trend_visualization.png)

## Disclaimer

While this tool aims to provide similar insights to Kubios Premium, it is not a medical device or professional analysis tool. This is a tool for personal use and should not replace professional medical advice.

## Data Sources

This script processes RR interval data from multiple sources:

### EliteHRV (.txt files)
You can export your data from EliteHRV's [settings menu](https://help.elitehrv.com/article/49-exporting-raw-r-r-intervals-or-interbeat-intervals-ibis).

### ECGApp and other tools (.csv files)
Many HRV monitoring apps export data in CSV format. Ensure the file contains an 'RR' column with interval values in milliseconds.
